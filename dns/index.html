<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Don't say Propagation - 浸透いうな</title>
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div id="page-container">
      <header id="page-header">
        <div class="content-inner">
          <h1 class="page-title">Don't say Propagation - 浸透いうな</h1>
          <div class="misc">
            <p class="author">Author: <a href="https://twitter.com/debiru_R">@debiru_R</a></p>
            <ul class="revision">
              <li>公開：2022年9月20日</li>
            </ul>
          </div>
          <div class="desc">
            <p class="lead">言葉狩りではない、「浸透いうな」に込められた深い意味について解説します。</p>
            <p class="keywords">キーワード：<strong>DNS</strong> / <strong>サーバ移転</strong> / <strong>浸透(penetration)</strong> / <strong>伝播/伝搬(propagation)</strong> / <strong>反映</strong> / <strong>浸透待ち</strong></p>
          </div>
        </div>
      </header>
      <hr />
      <main id="page-main">
        <section id="sect-1">
          <div class="content-inner">
            <h2 class="section-heading"><a href="#sect-1">¶</a> 1章：導入</h2>
            <div class="section-body">
              <p>DNS (Domain Name System) 権威サーバの機能を提供するサービス事業者が、DNSの設定を変更してから反映されるまでに時間がかかることについて、次のような説明をしていることがあります。</p>
              <blockquote>
                <p>世界中のDNSサーバへ情報が浸透するまで約1～3日程（※）かかります。</p>
                <p>※DNSが浸透する期間はあくまでも目安です。どのぐらいの期間がかかるか特定は出来ません。</p>
              </blockquote>
              <p>サービス事業者によってこのような説明が横行していることは、次の記事からも知ることができます。</p>
              <ul>
                <li><a href="https://www.e-ontap.com/dns/propagation/hosting_faq.html">ホスティング業者によって「浸透」等が不適切に使われている例 - www.e-ontap.com</a></li>
                <li><a href="https://ohesotori.hateblo.jp/entry/20180513/1526226732">DNS浸透言ってるところと言っていないところ【レンタルサーバ編】 - ohesotori.hateblo.jp</a></li>
              </ul>
              <p>次に、一般利用者によって次のような発言がされることがあります。</p>
              <blockquote>
                <p>DNSの設定を変更したけど、情報が浸透するまで24時間〜72時間くらい待たないといけないみたい。</p>
              </blockquote>
              <p>Twitterで「DNS 浸透」とでも検索をすると似たようなツイートをいくつも見つけることができます。</p>
              <p>これらの説明、発言には重大な問題が含まれています。どのような問題があるのかについて説明していきます。</p>
            </div>
          </div>
        </section>
        <section id="sect-2">
          <div class="content-inner">
            <h2 class="section-heading"><a href="#sect-2">¶</a> 2章：問題点</h2>
            <div class="section-body">
              <p>「浸透をお待ちください」や「浸透するまで待たないと」と言っている発言者の立場ごとに、いくつかの問題が存在しています。</p>
            </div>
          </div>
          <section id="sect-2-1">
            <div class="content-inner">
              <h3 class="section-heading"><a href="#sect-2-1">¶</a> DNSサービス事業者が発言した場合</h3>
              <div class="section-body">
                <ul>
                  <li>「DNSは浸透するもの、浸透待ちが起こるもの」という誤解を広めている。</li>
                  <li>DNS設定を行う際の適切な手順についての説明を全くしていない。</li>
                  <li>適切な手順で設定を行えば待つ必要がないものについて、待つ必要があると誤った説明をしている。</li>
                  <li>DNSサービス事業者としての責任を放棄している。誤った説明で一般利用者を騙している。</li>
                </ul>
              </div>
            </div>
          </section>
          <section id="sect-2-2">
            <div class="content-inner">
              <h3 class="section-heading"><a href="#sect-2-2">¶</a> Web制作事業者が発言した場合</h3>
              <div class="section-body">
                <ul>
                  <li>お客さんに必要のない「DNS設定」の時間待ちを発生させてしまっている。</li>
                  <li>（誤った理解に基づいて）ブログ記事などを書くことで、「DNSは浸透するもの」という誤解を広めている。</li>
                  <li>Web制作事業者として（プロとして）、本来有するべきDNSに対する基礎的な理解が足りていない。</li>
                </ul>
              </div>
            </div>
          </section>
          <section id="sect-2-3">
            <div class="content-inner">
              <h3 class="section-heading"><a href="#sect-2-3">¶</a> Webサイト運営者が発言した場合</h3>
              <div class="section-body">
                <ul>
                  <li>「DNSの設定が反映されるまでアクセスしにくくなります」などと言って、サイト閲覧者に不便を強いてしまう。</li>
                  <li>そのような誤ったアナウンスを行うことで、「DNSは浸透待ちが起こるもの」という誤解を広めてしまう。</li>
                  <li>「反映される」とは何を意味しているのか分かっていない。何を以て「反映完了」なのか説明できない。</li>
                </ul>
              </div>
            </div>
          </section>
          <section id="sect-2-4">
            <div class="content-inner">
              <h3 class="section-heading"><a href="#sect-2-4">¶</a> 一般利用者・個人が発言した場合</h3>
              <div class="section-body">
                <ul>
                  <li>待つ必要がないものについて、何時間も待って無駄に過ごしてしまっている。</li>
                  <li>他人に「DNSは設定後に何時間か待つ必要がある」と誤った説明をしてしまう。</li>
                  <li>DNS設定を行う際の適切な手順について、いつまで経っても覚えることができない。</li>
                </ul>
              </div>
            </div>
          </section>
          <div class="content-inner">
            <div class="section-body">
              <p>立場は他にもあるかもしれませんが、少なくとも上記のような問題があるのです。</p>
              <p>「浸透」という言葉（表現）自体が問題だという意味ではないことに注意してください。そうではなく、そもそも適切な手順で設定すれば待つ必要がないものについて、誤った手順で設定した上に、その言い訳として「浸透待ち」などと言っていることが問題なのです。</p>
              <p>「設定が変更されるのを待っている」、「反映されるのを待っている」などと言い換えても同じことです。浸透という言葉狩りではないことが理解できたのであれば次のステップに進みましょう。</p>
            </div>
          </div>
        </section>
        <section id="sect-3">
          <div class="content-inner">
            <h2 class="section-heading"><a href="#sect-3">¶</a> 3章：浸透待ちの正体</h2>
            <div class="section-body">
              <p>「DNS設定後は待つ必要がある」と誤解されるようになったことには何かしらの理由があります。その理由を説明します。</p>
            </div>
          </div>
          <section id="sect-3-1">
            <div class="content-inner">
              <h3 class="section-heading"><a href="#sect-3-1">¶</a> DNSレコードの設定後になぜすぐ反映されないのか</h3>
              <div class="section-body">
                <p>DNS は「DNSキャッシュサーバ（フルリゾルバとも）」と「権威DNSサーバ（ゾーンサーバとも）」の2種類のサーバによって機能しています。</p>
                <ul>
                  <li>「DNSキャッシュサーバ」は、問い合わせを仲介する役目です。負荷分散のために存在しています。</li>
                  <li>「権威DNSサーバ（ゾーンサーバ）」は、DNSのリソースレコードが設定されているDNSサーバです。DNSレコードを管理する場合は、このサーバにDNSの設定を保存します。</li>
                </ul>
                <figure class="object">
                  <p><img src="img/3-1.png" alt="" /></p>
                  <figcaption><a href="img/3-1.png" target="_blank">図1「DNSキャッシュサーバとゾーンサーバの関係」（<u>別ウィンドウで開く</u>）</a></figcaption>
                </figure>
                <p>インターネットを利用するとき、クライアント端末（お使いのPCやスマートフォンなど）はISP経由でネットワークに繋がっています。そして、ISPは一般的に、ISPごとに「DNSキャッシュサーバ」を持っています。携帯キャリアを例に言えば、「Softbank回線とDocomo回線では、使われるDNSキャッシュサーバが異なる」というわけです。</p>
                <p>実際のDNS問い合わせの例を考えてみましょう。Softbank回線を使っていて、<code>twitter.com</code> のIPアドレスを問い合わせたとします。このとき、SoftbankのISPのDNSキャッシュサーバがその問い合わせの応答を以前に行い、そのキャッシュを持っていたら、キャッシュサーバはゾーンサーバに問い合わせることなくキャッシュを応答します。</p>
                <p>次にDocomo回線を使っていて、<code>twitter.com</code> のIPアドレスを問い合わせたとします。このとき、DocomoのISPのDNSキャッシュサーバが応答をキャッシュしていなかったら（あるいはキャッシュの期限が切れていたら）、キャッシュサーバはゾーンサーバに問い合わせを行います。そして得られた結果をキャッシュしつつ、クライアント端末に応答します。</p>
                <p>キャッシュが使われるかどうかは、DNSキャッシュサーバにキャッシュが存在するかどうかに依ります。キャッシュが存在する間は、権威DNSサーバを書き換えても、クライアント端末には<strong>書き換え前の古い情報</strong>が応答されてしまうのです。</p>
                <p>キャッシュによって古い応答が返される時間が存在すること、これが「DNSレコードの設定後に、それがすぐ反映されない」理由です。</p>
              </div>
            </div>
          </section>
          <div class="content-inner">
            <div class="section-body">
              <p>キャッシュは生存期間（TTL）が設定されているため、時間が経つと失効され、キャッシュサーバがゾーンサーバに問い合わせるようになり、新しい情報がクライアント端末に返されるようになります。この状況を、DNSレコードを設定したDNS権威サーバからどこかに情報が伝播されていく、浸透していくものだと勘違いして「<strong>浸透待ち</strong>」と呼んでしまっているのです。これが浸透待ちの正体です。</p>
              <p>DNSの世界には「DNSキャッシュサーバ」というフォワードキャッシュ（クライアントサイドのキャッシュ）が存在する、ということを理解したら次のステップへ進みましょう。</p>
            </div>
          </div>
        </section>
        <section id="sect-4">
          <div class="content-inner">
            <h2 class="section-heading"><a href="#sect-4">¶</a> 4章：DNSレコードの変更を即時反映するには</h2>
            <div class="section-body">
              <p>適切な手順でDNSの設定を行えば、何時間も待つことなくDNSの設定変更を完了させることができます。ここではその手順について説明します。ポイントは<strong>TTLの事前調整</strong>です。</p>
              <p>DNSレコードの変更には、大きく2つの変更があります。</p>
              <ul>
                <li>(1) NS以外のレコードの変更（Aレコードなどの変更）</li>
                <li>(2) NSレコードの変更（ネームサーバの移転）</li>
              </ul>
              <p>NSレコードの場合、TTLの事前調整ができない範囲があるため対策が異なります。その点も含めて、次のケースで適切な変更手順を見ていきましょう。</p>
              <ul>
                <li>Webサイトを移転するため、Aレコードを変更したい</li>
                <li>権威DNSサーバ（ネームサーバ）もWebサイトのAレコードも両方移転したい</li>
              </ul>
            </div>
          </div>
          <section id="sect-4-1">
            <div class="content-inner">
              <h3 class="section-heading"><a href="#sect-4-1">¶</a> 4-1章：Webサイトを移転するため、Aレコードを変更したい</h3>
              <div class="section-body">
                <p>よくある例ですね。浸透を待つ羽目になる手順と、即時反映に成功する手順を示します。</p>
                <p>移転前のDNSレコードの設定は次の通りだとします。そして、今日が12月1日で、12月25日の0時に移転したいとします。</p>
                <table>
                  <thead>
                    <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>www</td><td>A</td><td>198.51.100.1</td><td>3600</td></tr>
                  </tbody>
                </table>
                <p>移転後のIPアドレスは、<code>203.0.113.1</code> だとします。</p>
              </div>
            </div>
            <section id="sect-4-1-1">
              <div class="content-inner">
                <h4 class="section-heading"><a href="#sect-4-1-1">¶</a> 4-1-1章：浸透を待つ羽目になる手順</h4>
                <div class="section-body">
                  <p>Aレコードの値を <code>203.0.113.1</code> に変更して、12月25日0時ちょうどに保存します。</p>
                  <p>そしてあなたは言うのです。「DNSレコードを変更したのでアクセスが不安定になるかもしれません」と。</p>
                  <div class="warningBlock">
                    <p>この手順では、12月24日23時59分にアクセスがあり、そのタイミングでキャッシュが生成された場合、25日0時59分まで古いキャッシュが使われてしまいます。その間、そのDNSキャッシュサーバを利用するクライアント端末では、新しいサイトが見られずに古いサイトへアクセスさせられることになります。</p>
                  </div>
                </div>
              </div>
            </section>
            <section id="sect-4-1-2">
              <div class="content-inner">
                <h4 class="section-heading"><a href="#sect-4-1-2">¶</a> 4-1-2章：即時反映に成功する手順</h4>
                <div class="section-body">
                  <p>反映したい日時（25日0時）から、現在のTTLだけ早い日時（24日23時0分）よりも前に、AレコードのTTLを短くします。</p>
                  <p>「12月24日の22時50分」でもよいですし、「12月23日」でもよいですし、「12月1日」にやってしまってもよいでしょう。TTLには <code>0</code> を指定することはできない場合があるので、小さな値、例えば <code>10</code> や <code>60</code> あたりを設定するようにしましょう。</p>
                  <p>その状態のまま、Aレコードの値を <code>203.0.113.1</code> に変更して、12月25日0時ちょうどに保存します。</p>
                  <div class="infoBlock">
                    <p>この手順では、12月24日23時59分59秒にアクセスがあり、そのタイミングでキャッシュが生成された場合であっても、25日0時1分には古いキャッシュが失効するため、クライアント端末は新しいサイトをすぐに見られるようになります。</p>
                    <p>【注記】即時反映とは言っても、1分弱の誤差は生じてしまいます。しかし、その間の時間を「浸透待ち」と呼ぶ人はいないでしょう。</p>
                  </div>
                  <p>期待通り設定が変更できたことを確認できたら、必要に応じてTTLの値を <code>3600</code> に変更して保存します。</p>
                  <p>余談ですが、TTLをずっと短い値に設定しておけばいいじゃないかと考えることもできます。そうすればこのケースでは浸透待ちとは無縁になれそうです。実際、普段からAレコードのTTLを <code>60</code> に設定しているゾーンサーバが存在しています。そして、その行為に問題があると言われているわけでもありません。どう考えるかはあなた次第ですが、普段から短いTTLを使い続けるのも選択肢の一つです。</p>
                </div>
              </div>
            </section>
          </section>
          <section id="sect-4-2">
            <div class="content-inner">
              <h3 class="section-heading"><a href="#sect-4-2">¶</a> 4-2章：権威DNSサーバ（ネームサーバ）もWebサイトのAレコードも両方移転したい</h3>
              <div class="section-body">
                <p>24時間待っても反映されないことになり得るのがこのケースです。以下ではレジストリのNS設定と、移転前と、移転後のネームサーバが登場します。そして、今日が12月1日で、12月25日の0時に移転したいとします。</p>
                <p>自身が管理するドメイン名は <code>debiru.net</code> だとします。</p>
                <figure class="object">
                  <figcaption>レジストリの権威DNSサーバ (*.gtld-servers.net)</figcaption>
                  <table>
                    <thead>
                      <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                    </thead>
                    <tbody>
                      <tr><td>debiru.net.</td><td>NS</td><td>ns.example.com</td><td>172800</td></tr>
                    </tbody>
                  </table>
                </figure>
                <figure class="object">
                  <figcaption>移転前の権威DNSサーバ (ns.example.com)</figcaption>
                  <table>
                    <thead>
                      <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                    </thead>
                    <tbody>
                      <tr><td>www</td><td>A</td><td>198.51.100.1</td><td>3600</td></tr>
                      <tr><td>@</td><td>NS</td><td>ns.example.com</td><td>86400</td></tr>
                    </tbody>
                  </table>
                </figure>
                <figure class="object">
                  <figcaption><strong>移転後</strong>の権威DNSサーバ (ns.example.jp)</figcaption>
                  <table>
                    <thead>
                      <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                    </thead>
                    <tbody>
                      <tr><td colspan="4">(empty)</td></tr>
                    </tbody>
                  </table>
                </figure>
                <ul>
                  <li>移転後のネームサーバは、<code>ns.example.jp</code> だとします。</li>
                  <li>移転後のAレコードのIPアドレスは、<code>203.0.113.1</code> だとします。</li>
                </ul>
              </div>
            </div>
            <section id="sect-4-2-1">
              <div class="content-inner">
                <h4 class="section-heading"><a href="#sect-4-2-1">¶</a> 4-2-1章：浸透を待つ羽目になる手順（その壱）</h4>
                <div class="section-body">
                  <p>最悪の手順は、12月25日0時の少し前から作業を始めて、次のような状態にすることです。</p>
                  <figure class="object">
                    <figcaption>レジストリの権威DNSサーバ (*.gtld-servers.net)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>debiru.net.</td><td>NS</td><td><strong>ns.example.jp</strong></td><td>172800</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption>移転前の権威DNSサーバ (ns.example.com)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td>198.51.100.1</td><td>3600</td></tr>
                        <tr><td>@</td><td>NS</td><td>ns.example.com</td><td>86400</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption><strong>移転後</strong>の権威DNSサーバ (ns.example.jp)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td>203.0.113.1</td><td>3600</td></tr>
                        <tr><td>@</td><td>NS</td><td>ns.example.jp</td><td>86400</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <div class="warningBlock">
                    <p>この手順では、Aレコードだけを変更する場合と同様の「浸透待ち」が生じます。最悪で172800秒（2日間）も古いキャッシュが使われてしまうでしょう。</p>
                  </div>
                </div>
              </div>
            </section>
            <section id="sect-4-2-2">
              <div class="content-inner">
                <h4 class="section-heading"><a href="#sect-4-2-2">¶</a> 4-2-2章：浸透を待つ羽目になる手順（その弐）</h4>
                <div class="section-body">
                  <p>次の手順は、Aレコードだけの変更と同様に対策をした手順ですが、どうなるでしょう。</p>
                  <p>12月1日に作業してみましょう。移転前のゾーンサーバのAとNSのTTLを <code>60</code> にしておきます。</p>
                  <figure class="object">
                    <figcaption>レジストリの権威DNSサーバ (*.gtld-servers.net)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>debiru.net.</td><td>NS</td><td>ns.example.com</td><td>172800</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption>移転前の権威DNSサーバ (ns.example.com)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td>198.51.100.1</td><td><strong>60</strong></td></tr>
                        <tr><td>@</td><td>NS</td><td>ns.example.com</td><td><strong>60</strong></td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption><strong>移転後</strong>の権威DNSサーバ (ns.example.jp)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td colspan="4">(empty)</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <p>そして、12月25日0時の少し前に作業を始めて、次の状態にします。</p>
                  <figure class="object">
                    <figcaption>レジストリの権威DNSサーバ (*.gtld-servers.net)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>debiru.net.</td><td>NS</td><td><strong>ns.example.jp</strong></td><td>172800</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption>移転前の権威DNSサーバ (ns.example.com)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td>198.51.100.1</td><td>60</td></tr>
                        <tr><td>@</td><td>NS</td><td>ns.example.com</td><td>60</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption><strong>移転後</strong>の権威DNSサーバ (ns.example.jp)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td>203.0.113.1</td><td>60</td></tr>
                        <tr><td>@</td><td>NS</td><td>ns.example.jp</td><td>60</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <div class="warningBlock">
                    <p>うまく工夫したように見えますが、実はこの手順では「浸透待ち」が生じることが知られています。レジストリのTTLが変更できていないことに注目してください（そして、それは変更することができません！）。</p>
                    <p>この手順でも、前の手順と同様に、最悪で172800秒（2日間）も古いキャッシュが使われてしまうでしょう。</p>
                  </div>
                </div>
              </div>
            </section>
            <section id="sect-4-2-3">
              <div class="content-inner">
                <h4 class="section-heading"><a href="#sect-4-2-3">¶</a> 4-2-3章：即時反映に成功する手順</h4>
                <div class="section-body">
                  <p>12月1日に作業してみましょう。遅くとも1週間前くらいに作業してしまったほうがよいでしょう。</p>
                  <p>まず、移転後の権威DNSサーバに、移転前の情報を書き込みます。そして、ネームサーバだけ移転してしまいます。ついでに、AレコードのTTLを <code>60</code> に事前に短くしておきましょう。さらに、移転前のネームサーバのNSレコードを、移転後のネームサーバに書き換えておきます。</p>
                  <figure class="object">
                    <figcaption>レジストリの権威DNSサーバ (*.gtld-servers.net)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>debiru.net.</td><td>NS</td><td><strong>ns.example.jp</strong></td><td>172800</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption>移転前の権威DNSサーバ (ns.example.com)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td>198.51.100.1</td><td><strong>60</strong></td></tr>
                        <tr><td>@</td><td>NS</td><td><strong>ns.example.jp</strong></td><td>86400</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption><strong>移転後</strong>の権威DNSサーバ (ns.example.jp)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td>198.51.100.1</td><td>60</td></tr>
                        <tr><td>@</td><td>NS</td><td>ns.example.jp</td><td>86400</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <p>そして、12月25日0時の少し前に作業を始めて、次の状態にします。</p>
                  <figure class="object">
                    <figcaption>レジストリの権威DNSサーバ (*.gtld-servers.net)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>debiru.net.</td><td>NS</td><td>ns.example.jp</td><td>172800</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption>移転前の権威DNSサーバ (ns.example.com)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td>198.51.100.1</td><td>60</td></tr>
                        <tr><td>@</td><td>NS</td><td>ns.example.jp</td><td>86400</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <figure class="object">
                    <figcaption><strong>移転後</strong>の権威DNSサーバ (ns.example.jp)</figcaption>
                    <table>
                      <thead>
                        <tr><th>Host</th><th>RR Type</th><th>Value</th><th>TTL</th></tr>
                      </thead>
                      <tbody>
                        <tr><td>www</td><td>A</td><td><strong>203.0.113.1</strong></td><td>60</td></tr>
                        <tr><td>@</td><td>NS</td><td>ns.example.jp</td><td>86400</td></tr>
                      </tbody>
                    </table>
                  </figure>
                  <div class="infoBlock">
                    <p>成功の秘訣は、NS移転とA移転を別々に行うことがポイントです。NS移転だけ先に行ってしまうことで、課題を「Aレコードだけ変更する」状態に帰着させています。</p>
                    <p>移転前のネームサーバには、（12月1日に作業したのであれば）12月3日の同時刻以降にはもはや問い合わせは来ないはずなので、25日の移転時にレコードを編集する必要はありません（移転前のネームサーバをクローズしてしまっても良いでしょう）。</p>
                    <p>この手順であれば、高々1分待つだけで、DNS設定の変更を反映させることができます。</p>
                  </div>
                  <p>「移転後のネームサーバを使えるのが12月24日からだ」といったケースがあるかもしれませんが、それは事前準備不足です。DNSの仕組みを理解していれば、（.net/.comドメイン名の場合）遅くとも12月22日（移転の3日前）から移転後のネームサーバが利用できないと手遅れであることに気付くでしょう。</p>
                </div>
              </div>
            </section>
          </section>
          <section id="sect-4-3">
            <div class="content-inner">
              <h3 class="section-heading"><a href="#sect-4-3">¶</a> 4章まとめ</h3>
              <div class="section-body">
                <p>長くなりましたが、「4章：DNSレコードの変更を即時反映するには」のまとめは次の通りです。</p>
                <ul>
                  <li>Aレコードなどの変更時には、<strong>TTLの事前調整</strong>をする。</li>
                  <li>NS移転とA移転（など）を同時に行わない。</li>
                </ul>
                <p>この手順を覚えることができれば、二度と「浸透待ち」に悩まされることはなくなるはずです。</p>
              </div>
            </div>
          </section>
        </section>
        <section id="sect-5">
          <div class="content-inner">
            <h2 class="section-heading"><a href="#sect-5">¶</a> 5章：</h2>
            <div class="section-body">
            </div>
          </div>
        </section>
        <section id="sect-6">
          <div class="content-inner">
            <h2 class="section-heading"><a href="#sect-6">¶</a> 6章：参考文献</h2>
            <div class="section-body">
              <ul>
                <li><a href="https://www.e-ontap.com/dns/propagation/harmful.html">なぜ「浸透」と言ってはいけないのか? - www.e-ontap.com</a></li>
                <li><a href="https://www.nslookup.io/blog/dns-propagation-does-not-exist/">DNS propagation does not exist - www.nslookup.io</a></li>
              </ul>
            </div>
          </div>
        </section>
      </main>
      <hr />
      <footer id="page-footer">
        <Div class="content-inner">
          <p class="copyright">このページのオリジナルコンテンツは <a href="http://www.kmonos.net/nysl/">NYSL</a> ライセンスで提供します。</p>
          <p class="feedback">このページに関するフィードバックは <a href="https://twitter.com/debiru_R">@debiru_R</a> までご連絡ください。</p>
        </div>
      </footer>
    </div>
  </body>
</html>
v
